{% extends "base.html" %}
{% block title %} Crea un nuovo corso {% endblock %}

{% block extra_head %}
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
{% endblock %}

{% block content %}
    <center>
        <form class="register-form" method="POST">
            <h1> <strong>CREA UN NUOVO CORSO</strong> </h1>
            <div class="input_fields">

                <label for="titolo"><b>Titolo</b></label>
                <p> Inserisci il titolo che vuoi dare al tuo corso. </p>
                <textarea type="text" id="titolo" name="titolo" class="inputform input-textarea" placeholder="Inserisci titolo" required rows="1"></textarea>

                <br>

                <label for="descrizione"><b>Descrizione</b></label>
                <p> Inserisci tutto quello che vuoi che gli studenti sappiano. Descrivi l'argomento del corso e come si svolgerà. </p>
                <textarea type="text" id="descrizione" name="descrizione" class="inputform input-textarea" placeholder="Inserisci descrizione" required rows="1"></textarea>

                <br>


            <div id="search-bar" class="search-bar">
                <label><b>Altri organizzatori</b></label>
                <p> Scegli chi organizza il corso insieme a te. </p>

                <!-- input nascosto per submit -->
                <input v-model="selection_str" type="text" name="organizzatori" class="very-hidden">

                <!-- STUDENTI SELEZIONATI -->
                <div id="selected-students">
                    <label><b>Selezionati:</b></label>

                    <div v-if="selected.length" id="selected-chips">
                        <div v-for="user in selected" :key="user.id" class="student-chip">
                            [[ user.full_name ]]
                            <button type="button" @click="deselect(user.email)">×</button>
                        </div>
                    </div>

                    <p v-if="selected.length == 0">
                        Non hai ancora scelto altri organizzatori oltre a te
                    </p>
                </div>

                <!-- INPUT RICERCA -->
                <div id="autocomplete-wrapper">
                    <input
                        v-model="query"
                        @input="search"
                        placeholder="Cerca studenti o professori"
                        class="inputform"
                        autocomplete="off"
                    />

                    <!-- DROPDOWN RISULTATI -->
                    <ul v-if="results.length" id="autocomplete-results">
                        <li
                            v-for="user in results"
                            :key="user.id"
                            @click="select(user.email)"
                            class="autocomplete-item"
                        >
                            [[ user.full_name ]]
                        </li>
                    </ul>

                    <p v-if="results.length == 0 && query.length >= 2 && !loading">
                        Nessun risultato per "[[ query ]]"
                    </p>
                </div>
            </div>

            <label for="fascia"><b>Fasce</b></label>
            <p> Scegli in quale fasce vuoi organizzare il tuo corso. Se uno degli organizzatori del corso è già occupato in un altro corso non verrà inserito tra i referenti per quella fascia. </p>
            <br>

            <div>
            {% for i in range(1, 6) %}
                <input type="checkbox" id="fascia{{i}}" name="fascia{{i}}" class="checkbox-form">
                <label for="fascia{{i}}">Fascia {{i}} ({{ orario_fascia[i] }})</label>
                <br>
            {% endfor %}
            </div>

            <br>

            <label for="note"><b>Note</b></label>
            <p> Note per i rappresentanti, non visibili agli studenti quando si iscriveranno. Inserire richieste particolari come aula, materiale, ospiti esterni ... </p>
            <textarea type="text" id="note" name="note" class="inputform input-textarea" placeholder="Inserisci note (facoltativo)" rows="1"></textarea>

            <button type="submit" class="outline_md_btn">
                Crea corso
            </button>
        </form>
    </center>

    <script src="{{url_for('static', filename='vue_logic.js')}}"> </script>

    <script>
        const textArea = document.getElementsByClassName('input-textarea');

        [].forEach.call(textArea, (textArea) => {
            textArea.style.height = textArea.scrollHeight + "px";
            textArea.style.overflowY = "hidden";

            textArea.addEventListener("input", function () {
                this.style.height = "auto";
                this.style.height = this.scrollHeight + "px";
            });
        })

    </script>
{% endblock %}
